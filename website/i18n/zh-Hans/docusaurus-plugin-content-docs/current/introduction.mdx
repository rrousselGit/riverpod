---
title: Riverpod介绍
---

---

## 什么是Riverpod?

Riverpod ([Provider](https://pub.dev/packages/provider)字母变换顺序) 是Flutter/Dart平台
的一个响应式缓存框架。 它能自动获取、缓存、合并和计算网络请求，同时还会为你处理错误。

## 动机

现代的应用程序很少带有用户界面所需要的所有信息。一般来说，那些数据会从服务器异步获取。

但问题是，与异步代码工作是比较难的。虽然说Flutter平台有一些存储状态的方法，除此之外，
它并没有额外的功能。 所以，有许多问题仍然没有解决方案：

- 异步请求需要在本地缓存，但当UI刷新时重新执行请求是不合理的。
- 由于缓存的存在，如果我们不小心可能导致缓存过期。
- 我们也需要处理错误和加载中的各种状态。

大规模解决问题会比较困难，而且它们受到了许多功能的影响，比如：

- 下拉刷新
- 列表滚动加载
- 在键入时搜索
- 异步请求防抖
- 当不再需要时取消异步请求
- optimistic UIs
- 离线模式
- ...

实现这些功能很棘手，但这对一个良好的用户体验至关重要。
然而很少有package试图解决这些问题，大量的样板代码需要手工完成。

这就是Riverpod的由来。  
Riverpod尝试解决这些问题——通过一种独特的方式编写业务逻辑，它的灵感来自于Flutter widgets。
对于状态来说，在许多方面Riverpod都可以与widget相比较。

这个框架会帮你处理大多数复杂的功能。你只需关注在你的UI上面。

感到怀疑？这里有一个例子：下面的代码片段是使用riverpod的一个简化的[Pub.dev](https://github.com/rrousselGit/riverpod/tree/master/examples/pub)
客户端应用。

```dart
// 从pub.dev获取package列表
@riverpod
Future<List<Package>> fetchPackages(
  FetchPackagesRef ref, {
  required int page,
  String search = '',
}) async {
  final dio = Dio();
  // 请求的API. 这里我们用了dio,当然你也可以使用其他的网络请求库。
  final response = await dio.get(
    'https://pub.dartlang.org/api/search?page=$page&q=${Uri.encodeQueryComponent(search)}',
  );

  // 将返回的JSON解码到Dart的对象。
  final json = response.data as List;
  return json.map(Package.fromJson).toList();
}
```

你可以用这段代码来处理"在键入时搜索" + "下拉刷新" + "无限列表" 的业务逻辑，同时还可以处理错误及加载中的状态。
